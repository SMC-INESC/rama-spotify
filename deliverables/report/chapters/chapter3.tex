%!TEX root = ../mieic.tex

\chapter{Context and Methodologies}
\label{chap:chap3}

\section*{}

The primal objective of this dissertation, as referred in chapter \ref{chap:intro}, is to develop one or more software modules that will improve Spotify Users' music discovery and recommendation experience using visual tools to represent the music artists' relations and Spotify's streaming service to provide high quality music stream.

The initial proposal was to develop a module that implements, at least, one of the following features:

\begin{enumerate}
  \item \label{item:obj1} Integrate Spotify's music stream into RAMA's website
  \item \label{item:obj2} Integrate information from the Spotify user into RAMA
  \item \label{item:obj3} Improve RAMA's features and design
  \item \label{item:obj4} Integrate the RAMA concept into a Spotify Application
  \item \label{item:obj5} Integrate RAMA's playlist generation into a Spotify Application
  \item \label{item:obj6} Integrate some of the above mentioned modules into a Mobile Application
\end{enumerate}

The first three functionalities (\ref{item:obj1}, \ref{item:obj2} and \ref{item:obj3}) focus on improving RAMA using Spotify's API, i.e. to integrate Spotify into RAMA.
Whereas \ref{item:obj4} and \ref{item:obj5} aim to integrate RAMA's concept into Spotify, through a Spotify Application (it would work as a plugin to Spotify's Desktop Client).
The last one (\ref{item:obj6}) would focus on implementing the previous functionalities into an Android, iOS or Windows Phone Application.

This chapter aims to analyse every single drawback of each possibility that affects the choice of which modules do develop, and on which environments it fits better: Spotify Application, Mobile Application, or RAMA improvements.

At first, Spotify's development environment will be introduced \ref{sec:spotify} in order to assess which tools are available for developers.
Next, the available tools will be evaluated in order to determine which ones fit the proposed modules to be developed, mostly, through experiments. 

By the end of this chapter the modules to be developed should be clearly stated, as well as which tools will be used in the prototype.

The prototype should pursue the objective of contributing to an improved user experience when discovering new music taking advantage of visual tools that implement RAMA's concept.

\section{Introducing Spotify} % (fold)
\label{sec:spotify}

  Spotify is a Music Streaming Service that allows the user, through an Internet connection, to listen to any track (if available in the user's country) in Spotify's catalogue.
  The service was launched in 2008 with a native desktop client application.

  % clients available: desktop client, webplayer and mobile apps
  Now, the service has several types of clients available to the users: desktop client, webplayer and mobile applications.

  \begin{description}
    \item[\textbf{Desktop Client}] Desktop version of Spotify, with Windows and Mac versions (and also a Linux preview version).
    \item[\textbf{Webplayer}] Web version of Spotify. This was released in 2013, and spotify still advises the use of the native applications for a better user experience.
    \item[\textbf{Mobile Applications}] The mobile applications are available for Android and iOS devices.
  \end{description}

  \subsection{Development Tools} % (fold)
  \label{sub:devtools}
  
    Spotify provides a set of tools\footnote{http://developer.spotify.com/technologies} to develop Third-party Applications (websites, native applications and mobile applications) and Spotify Applications (that run inside Spotify's Desktop Client).
    There are five tools, each with different purposes.

    \subsubsection{Spotify Apps} % (fold)
    \label{ssub:spotify_apps}
      Spotify Applications\footnote{https://developer.spotify.com/technologies/apps} are a special case in the whole set of tools provided by Spotify.
      These applications are designed to run \emph{inside} the Desktop Client.
      Hence, its development is also inside the same environment.

      Spotify users can run and install applications from the store called "App Finder".
      All the applications are free.

      In \ref{fig:spotify_apps} on can see the interface of the desktop client.
      In this case, the discovery mode's interface.

      \begin{figure}
        \begin{center}
          \includegraphics[width=\textwidth]{spotify.pdf}
        \end{center}
        \caption{Spotify: desktop client's discovery mode interface.}
        \label{fig:spotify_apps}
      \end{figure}

      On the left side, in the menu, bellow the "App Finder" item, appears all the applications the user as installed from the store.

      In \ref{fig:spotify_apps2} the official Last.fm application is opened.
      Note how the space filled by the applications are always the same.

      \begin{figure}
        \begin{center}
          \includegraphics[width=\textwidth]{spotify_apps.pdf}
        \end{center}
        \caption{Spotify: Last.fm's Spotify Application opened.}
        \label{fig:spotify_apps2}
      \end{figure}

      The Applications' runtime environment is one of a browser-based.
      More specifically, powered by the Chromium Embedded Framework\footnote{https://code.google.com/p/chromiumembedded}.
      This means that the code to develop a Spotify Application follows the same principles as a web application: HTML, CSS and Javascript.

      Spotify developed two Frameworks\footnote{https://developer.spotify.com/technologies/apps/reference} to help developers create these applications: the API 1.x Framework\footnote{https://developer.spotify.com/docs/apps/api/1.0/} and the Views Framework\footnote{https://developer.spotify.com/docs/apps/views/1.0/}.

      The first one provides an interface to use object models, access metadata, control the player, among others.
      The second offers support for web components like buttons, lists, tabs, among others.

      In order to develop the proposed modules \ref{item:obj4} and \ref{item:obj5}, these are the most appropriate tools.

    % subsubsection spotify_apps (end)


    \subsubsection{Spotify Widgets} % (fold)
    \label{ssub:spotify_widgets}

      Spotify Widgets\footnote{https://developer.spotify.com/technologies/widgets} are small web components that can be embedded in external websites.
      Spotify provides two components: \emph{Play Button} (\ref{fig:spotify_play_button}) and a \emph{Follow Button} (\ref{fig:spotify_follow_button})

      \begin{figure}
        \begin{center}
          \includegraphics{spotify_play_button.pdf}
        \end{center}
        \caption{Spotify: \emph{Play Button}.}
        \label{fig:spotify_play_button}
      \end{figure}

      \begin{figure}
        \begin{center}
          \includegraphics{spotify_follow_button.pdf}
        \end{center}
        \caption{Spotify: \emph{Follow Button} Allows the user to follow the music artist.}
        \label{fig:spotify_follow_button}
      \end{figure}

      However, there are some limitations.
      In Spotify, only logged in users can use the service (listen to tracks, etc).
      This also applies to these widgets - Even if they are in an external application, only Spotify users can interact with them.

      This limitation does make sense in the case of the \emph{Follow Button}, but the \emph{Play Button} becomes useless to non-spotify users.

      In truth, these widgets are nothing but an hyperlink to a Spotify Client (Web Player or Desktop).
      With the Play Button, the stream of tracks always played inside Spotify's environment, and not on external applications.

      To embed a widget, it is only required to copy-paste Html code into the website, where appropriate:

      \lstinputlisting[language=HTML,caption={Html code to embed the \emph{Play Button}}]{snippets/play_button.html}

      These widgets are useful to develop the proposed modules \ref{item:obj1} and \ref{item:obj3}.

    % subsubsection spotify_widgets (end)

    \subsubsection{Libspotify SDK} % (fold)
    \label{ssub:libspotify_sdk}

      Libspotify SDK\footnote{https://developer.spotify.com/technologies/libspotify} is an API that allows for third-party applications to include Spotify's services into them.
      However, not without some limitations to the users of these applications.
      The users are limited depending on the type of Spotify Subscription that they have signed up to.

      There are three different types of subscriptions, but the important to retain, is the difference between being a Free Subscription Spotify User, and a Paid Subscription Spotify User (premium and unlimited subscriptions).
      As mentioned before (\ref{ssub:spotify_widgets}), only Spotify users can interact with the widgets.
      That also applies to third-party applications that are using Libspotify SDK, which allow, for example, the user to login with their Spotify account.
      But in this case, not only they need to be Spotify users, they also need to have signed up to a paid Spotify subscription.
      And not only do the users need to pay to use the Spotify-powered application, but the developers as well.

      This is a very restrictive environment, although Libspotify SDK comes in many different flavours\footnote{https://developer.spotify.com/technologies/libspotify/\#libspotify-downloads}.

      This tool would be used to develop modules \ref{item:obj1}, \ref{item:obj2} and \ref{item:obj6}.
      

    % subsubsection libspotify_sdk (end)


    \subsubsection{Metadata API} % (fold)
    \label{ssub:metadata_api}

      The \emph{Metadata API}\footnote{https://developer.spotify.com/technologies/web-api} allows for applications to retrieve information from Spotify's music catalogue: tracks, albums, artists, playlists, and so on.

      Requests to the database are done through HTTP and are of two types: \emph{search}\footnote{https://developer.spotify.com/technologies/web-api/search} e \emph{lookup}\footnote{https://developer.spotify.com/technologies/web-api/lookup}.

      To request detailed information of, e.g., an artist, the URI (used as the unique identifier) of that artist is required. Such ID is of the form:

      \url{spotify:artist:<artist_id>}, where \emph{artist\_id} is the unique identifier of the artist.

      Example:

      \url{spotify:artist:65nZq8l5VZRG4X445F5kmN}, is the ID for the artist "Mariza". \\

      There's also ID's for albums:

      \url{spotify:album:5d1LpIPmTTrvPltx26TlEU} (album "Fado Tradicional" from "Mariza") \\

       and for tracks:

       \url{spotify:track:2vqYasauhDLVjTt7CGWK6y} (track "Fado Vianinha" of the previous album) \\

      These URI schemes are compliant with Rosetta Stone's ID spaces\footnote{http://developer.echonest.com/docs/v4\#project-rosetta-stone}.

      First, to get this URI, one needs to search the database.

      \begin{description}
        \item[\emph{Search}] \hfill

          The base \emph{URL}:

          \url{http://ws.spotify.com/search/1/album}, to search for albums.

          For artists, \emph{artist}, for tracks, \emph{track}. \\

          Examples:

          \url{http://ws.spotify.com/search/1/album?q=foo} \\
          \url{http://ws.spotify.com/search/1/artist.json?q=red+hot} \\

          The request response, by default, is formatted in \emph{XML}, although, as the second example demonstrates, \emph{JSON} is also supported.

          Given the following query: \\
          \url{http://ws.spotify.com/search/1/artist.json?q=camane}

          The server responds with:

          \lstinputlisting[caption={Results ordered by "popularity"}]{snippets/search_camane.json}

        \item[\emph{Lookup}] \hfill \\

          When the URI is known, one can finally lookup detailed information about a database item.

          With the following \emph{query}: \\
          \url{http://ws.spotify.com/lookup/1/.json?uri=spotify:artist:3MLPFTe4BrpEV2eOVG0gLK}

          The server responds with:

          \lstinputlisting[caption={\emph{lookup} of the artist "Camané"}]{snippets/lookup_camane.json}

      \end{description}

      This API is very useful to all the six proposed modules.

    % subsubsection metadata_api (end)

    \subsubsection{iOS SDK (beta)} % (fold)
    \label{ssub:ios_sdk}
    
    The iOS SDK supports iOS Application developers. Although still in beta\footnote{https://developer.spotify.com/technologies/spotify-ios-sdk}, this tool would be used to develop the proposed module \ref{item:obj6}.
    Much like the Libspotify SDK, this SDK provides the following APIs:

    \begin{itemize}
      \item User authentication
      \item Audio playback and stream management
      \item Metadata (artist, album, track) lookup including artwork
      \item Playlist management
    \end{itemize}

    % subsubsection ios_sdk (end)

  % subsection devtools (end)

  \subsection{Experimentações Feitas} % (fold)
  \label{sub:experimentacoes}
  
    Numa primeira experiência com as ferramentas, foi criado um pequeno \emph{website} que permite pesquisar e ouvir Música do Spotify usando a \emph{Metadata API} e \emph{Spotify Widgets}: \\

    \url{http://carsy.github.io/spotify-playground} \\

    Na figura \ref{fig:playground} é possível ver o resultado de uma pesquisa, e a \emph{Widget Play Button} com o resultado selecionado da pesquisa.

    \begin{figure}
      \centering

      \begin{subfigure}[b]{0.38\textwidth}
        \includegraphics[width=\textwidth]{playground.pdf}
        \caption{Resultado da pesquisa "Mariza"}
        \label{fig:playgroun_a}
      \end{subfigure}

      \begin{subfigure}[b]{0.38\textwidth}
        \includegraphics[width=\textwidth]{playground2.pdf}
        \caption{Depois de selecionado o álbum "Fado Tradicional" aparece o \emph{Play button} com as faixas do álbum.}
        \label{fig:playground_b}
      \end{subfigure}

      \caption{Experiência com \emph{Metadata API} e \emph{Play Button Widget} (código fonte: \url{github.com/carsy/spotify-playground})}
      \label{fig:playground}

    \end{figure}

    Verificou-se que as duas ferramentas estão bem documentadas e em constante atualização. \\

    Outra experiência foi realizada para verificar se é possível usar o elemento \emph{canvas} numa Aplicação Spotify.
    Isto é necessário pois será a única forma de poder desenhar graficamente o grafo.
    Para isso foi apenas necessário criar uma aplicação com o seguinte código fonte:

    \begin{lstlisting}[caption={Elemento \emph{iframe} que embebe o \emph{website} do RAMA na aplicação}]
      <iframe src="http://rama.inescporto.pt/app" frameborder="0"></iframe>\end{lstlisting}

    Desta forma, é possível embeber o RAMA na Aplicação Spotify (que usa o elemento \emph{canvas} para desenhar o grafo).
    Resultado final na figura \ref{fig:rama_spotifyed}.

    \begin{figure}
      \begin{center}
        \includegraphics[width=\textwidth]{rama.pdf}
      \end{center}
      \caption{\emph{Website} do RAMA embebido numa Aplicação Spotify}
      \label{fig:rama_spotifyed}
    \end{figure}

    Apesar de \emph{iframes} serem suportadas, existem outros componentes que não o são.
    A aplicação não é usável, pois não permite, por exemplo, reproduzir automaticamente faixas de artistas.

    No entanto existe uma forma de testar quais os elementos de \emph{HTML5} suportados, usando uma aplicação interna do Spotify.
    Na figura \ref{fig:canvas_support} é possível ver que o elemento \emph{canvas} é suportado a cem por cento.

    \begin{figure}
       \begin{center}
         \includegraphics[width=0.5\textwidth]{canvas_support.pdf}
       \end{center}
       \caption{Resultado do teste do elemento \emph{canvas}}
       \label{fig:canvas_support}
     \end{figure}

  % subsection experimentacoes (end)

  \subsection{Conclusão} % (fold)
  \label{sub:conclusao}
  
    A prova de conceito desenvolvida (\ref{fig:rama_spotifyed}) demonstrou-se a mais indicada para o objetivo final de criar um ambiente integrado entre o Spotify e o RAMA.

    Assim, os módulos a serem desenvolvidos são \ref{item:obj4} e \ref{item:obj5}.

  % subsection conclusao (end)

% section spotify (end)

\section{Technologies used} % (fold)
\label{sec:technologies}

  As seguintes tecnologias serão utilizadas nas fase de desenvolvimento, testes e otimização da Aplicação Spotify.

  \subsection{\emph{Spotify Desktop Client}} % (fold)
  \label{sub:subsection_name}
    O desenvolvimento de Aplicações Spotify é feito de forma integrada no programa.

    Para abrir uma Aplicação Spotify, localmente, escreve-se o seguinte na barra de pesquisa: spotify:app:rama

    Onde \emph{rama} deve ser o identificador da aplicação declarado no ficheiro \emph{manifest.json}\footnote{ficheiro situado na \emph{root} da pasta do projeto}. \\
    Exemplo de ficheiro \emph{manifest.json}:

    \lstinputlisting[caption={manifest.json: \emph{BundleIdentifier} é o identificador da aplicação; \emph{Dependencies} declara as dependências das API's necessárias ao desenvolvimento.}]{snippets/manifest.json}

    Existem outras opções úteis a que se pode aceder usando a tab \emph{Develop} (\ref{fig:html5_support}).
    A opção "Show Inspector" abre a janela \emph{Webkit Development Tools} (\ref{sub:webkit_tools})

    \begin{figure}
      \begin{center}
        \includegraphics[width=0.6\textwidth]{html5_support.pdf}
      \end{center}
      \caption{Menu \emph{Develop}}
      \label{fig:html5_support}
    \end{figure}
  
  % subsection subsection_name (end)

  \subsection{Webkit Development Tools - webkit.org} % (fold)
  \label{sub:webkit_tools}

    A partir do \emph{webkit}, tem-se acesso a várias ferramentas úteis para o desenvolvimento \emph{web} (\ref{fig:webkit_inspector}).

    \begin{figure}
      \begin{center}
        \includegraphics[width=\textwidth]{webkit_inspector.pdf}
      \end{center}
      \caption{Webkit: Vista da tab \emph{Inspector}. Outas ferramentas disponíveis (tabs): \emph{Resources, Network, Sources, Timeline, Profiles, Audits} e \emph{Console}.}

      \label{fig:webkit_inspector}
    \end{figure}

    A mais importantes são:

    \begin{description}
      \item[Inspector] Permite inspecionar e editar o código \emph{HTML} e \emph{CSS} da aplicação diretamente  (\ref{fig:webkit_inspector}).
      \item[Network] Permite, por exemplo, ver o tempo que cada componente da aplicação demorou a carregar (uma imagem ou um ficheiro \emph{css}) (\ref{fig:webkit_network}).
      \item[Profile] Permite identificar que partes do código \emph{javascript} são as mais frequentemente executadas (\ref{fig:webkit_profile}).
      \item[Audit] Ajuda a perceber quantos recursos estão a ser descarregados desnecessariamente, como por exemplo, regras de \emph{CSS} que não estão a ser usadas (\ref{fig:webkit_audit}).
      \item[Console] Muito útil para \emph{debug} de \emph{javascript}.

    \end{description}


    \begin{figure}
      \begin{center}
        \includegraphics[width=\textwidth]{webkit_network.pdf}
      \end{center}
      \caption{Webkit Network}
      \label{fig:webkit_network}
    \end{figure}

    \begin{figure}
      \begin{center}
        \includegraphics[width=\textwidth]{webkit_profile.pdf}
      \end{center}
      \caption{Webkit Profile: É possível ver que a renderização do grafo é o que ocupa mais tempo de processamento como esperado. No entanto, existe uma parte de \emph{JQuery} que ocupa 12.72\% do tempo de processamento, o que pode indicar um possível ponto de melhoria de performance.}
      \label{fig:webkit_profile}
    \end{figure}

    \begin{figure}
      \begin{center}
        \includegraphics[width=\textwidth]{webkit_audit.pdf}
      \end{center}
      \caption{Webkit Audit: 96\% do código \emph{CSS} não está a ser usado, sendo por isso, um ponto de melhoria reduzir a quantidade de informação descarregada.}
      \label{fig:webkit_audit}
    \end{figure}

    \begin{figure}
      \begin{center}
        \includegraphics[width=\textwidth]{webkit_console.pdf}
      \end{center}
      \caption{Webkit Console: Erros de \emph{Javascript} aparecem destacados para chamar a atenção.}
      \label{fig:webkit_console}
    \end{figure}

  % subsection webkit_tools (end)

  \subsection{Npmjs - npmjs.org} % (fold)
  \label{sub:npm}
    Gestor de pacotes de software e dependências.
    Para usar \emph{npm} é necessário um ficheiro de configuração \emph{package.json} que permite identificar quais os pacotes de que a aplicação depende, e as suas versões. \\
    Exemplo:

    \lstinputlisting[caption={\emph{package.json}: ao indicar a versão com "*", significa que se deve usar sempre a mais recente.}]{snippets/package.json}

  % subsection npm (end)

  \subsection{Gruntjs - gruntjs.com} % (fold)
    \label{sub:gruntjs} 
      Programa de gestão de tarefas automatizadas.
      Muito útil para testes, compilação e otimização de código.
      É possível por exemplo, quando qualquer parte do código mudar, a aplicação automaticamente atualiza com as mudanças mais recentes, sem ser preciso refrescar manualmente a aplicação.
  % subsection gruntjs (end)

  \subsection{Arborjs - arborjs.org} % (fold)
  \label{sub:arborjs}
    Framework de javascript para desenho de grafos. Foi já utilizada no desenvolvimento do RAMA (existe sempre a possibilidade de se usar outra ferramenta substituta caso esta não for adequada).
  
  % subsection arborjs (end)

% section technologies (end)

\section{Conclusions}

  A escolha final do módulo a desenvolver é a Aplicação Spotify.

  Apesar de as outras opções serem também viáveis, a possibilidade de poder integrar uma interface estilo RAMA num ambiente que os utilizadores já se sentem confortáveis (Spotify), é muito favorável a que seja melhor aceite pelos mesmos.

  É esperado que as tecnologias a usar ajudem no desenvolvimento desta dissertação.

  Em suma, será desenvolvida uma Aplicação Spotify que implemente os módulos \ref{item:obj4} e \ref{item:obj5}.